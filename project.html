<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="180x180" href="src/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="src/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="src/favicon-16x16.png">
    <link rel="manifest" href="src/site.webmanifest">
    <link rel="mask-icon" href="src/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="src/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>

    <!-- Boxicons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <title>Explorar Projetos</title>

</head>

<body>

    <header id="navbar">
        <div class="navbar">
            <h1>CodePitch</h1>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="project.html">Explorar Projetos</a>
                <div id="userMenuContainer">
                    <button id="loginBtn" class="cta-button" onclick="openAuthModal()">
                        <span class="cta-text">Entrar</span>
                        <span class="cta-icon">üöÄ</span>
                    </button>
                    <div id="userDropdown" class="user-dropdown" style="display: none;">
                        <button class="user-button" onclick="toggleUserMenu()">
                            üë§ <span id="userNameDisplay">Usu√°rio</span>
                        </button>
                        <div id="dropdownContent" class="dropdown-content">
                            <button onclick="logout()">Sair</button>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="projects-section">
            <h2>Projetos em Destaque</h2>
            <div class="projects-grid" id="projectsGrid">
                <!-- Projetos ser√£o renderizados aqui via JavaScript -->
            </div>
        </section>
    </main>

</body>

</html>

<style>
    /* ================= VARI√ÅVEIS CSS ================= */
    :root {
        --primary-color: #58a6ff;
        --secondary-color: #7c3aed;
        --background-dark: #0d1117;
        --background-medium: #161b22;
        --background-light: #21262d;
        --text-primary: #c9d1d9;
        --text-secondary: #8b949e;
        --border-color: #30363d;
        --error-color: #f85149;
        --success-color: #238636;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--background-dark);
        color: var(--text-primary);
    }

    /* Header */
    header {
        position: fixed;
        width: 100%;
        background-color: var(--background-medium);
        padding: 1rem 2rem;
        top: 0;
        left: 0;
        z-index: 1000;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    header.scrolled {
        background-color: var(--background-dark);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
    }

    .navbar h1 {
        color: var(--primary-color);
        font-size: 1.8rem;
    }

    .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
    }

    .nav-links a {
        text-decoration: none;
        color: var(--text-primary);
        font-weight: 500;
        transition: color 0.2s;
    }

    .nav-links a:hover {
        color: var(--primary-color);
    }

    /* CTA Button */
    .cta-button {
        background-color: var(--primary-color);
        color: white !important;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        border: 1px solid var(--primary-color);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .cta-button:hover {
        background-color: #4595ff;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(88, 166, 255, 0.2);
    }

    /* Main Content */
    .container {
        padding-top: 80px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 100px 2rem 2rem;
    }

    .projects-section h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--primary-color);
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

    .project-card {
        background-color: var(--background-medium);
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }

    .project-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(88, 166, 255, 0.1);
    }

    .project-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .project-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-right: 1rem;
    }

    .project-image {
        width: 100%;
        height: 200px;
        background-color: var(--background-light);
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .project-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .project-description {
        color: var(--text-primary);
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .project-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .comment-btn {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .comment-btn:hover {
        background-color: #2ea043;
        transform: translateY(-2px);
    }

    .project-tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .tag {
        background-color: var(--primary-color);
        color: var(--background-dark);
        padding: 0.2rem 0.5rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    /* ================= MENU DE OP√á√ïES DO PROJETO ================= */
    .project-actions-menu {
        position: relative;
        margin-left: auto;
    }

    .menu-btn {
        all: unset;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        color: var(--text-primary);
        cursor: pointer;
        border-radius: 50%;
        transition: all 0.2s ease;
    }

    .menu-btn:hover {
        background-color: var(--background-light);
        color: var(--primary-color);
    }

    .menu-btn:focus-visible {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    .menu-options {
        position: absolute;
        right: 0;
        top: 100%;
        background-color: var(--background-medium);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        min-width: 140px;
        z-index: 10;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        display: none;
        transform-origin: top right;
        animation: fadeIn 0.2s ease-out;
    }

    .project-actions-menu.active .menu-options {
        display: block;
    }

    .menu-options button {
        all: unset;
        width: 100%;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
        color: var(--text-primary);
    }

    .menu-options button:first-child {
        border-bottom: 1px solid var(--border-color);
    }

    .menu-options button:hover {
        background-color: var(--primary-color);
        color: white;
    }

    /* √çcones SVG inline */
    .menu-options button::before {
        content: "";
        display: inline-block;
        width: 16px;
        height: 16px;
        background-color: currentColor;
        mask-size: contain;
        mask-repeat: no-repeat;
        mask-position: center;
    }

    .menu-options button:first-child::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/%3E%3C/svg%3E");
    }

    .menu-options button:last-child::before {
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/%3E%3C/svg%3E");
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    /* Dropdown do usu√°rio */
    .user-dropdown {
        position: relative;
    }

    .user-button {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .user-button:hover {
        background-color: #2ea043;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: var(--background-medium);
        min-width: 160px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        z-index: 1;
        border: 1px solid var(--border-color);
    }

    .dropdown-content button {
        background: none;
        border: none;
        color: var(--text-primary);
        padding: 0.75rem 1rem;
        width: 100%;
        text-align: left;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .dropdown-content button:hover {
        background-color: var(--background-light);
    }

    /* Responsividade */
    @media (max-width: 768px) {
        .projects-grid {
            grid-template-columns: 1fr;
        }
        
        .menu-options {
            min-width: 120px;
        }
        
        .menu-options button {
            padding: 0.6rem 0.8rem;
            font-size: 0.9rem;
        }
    }
</style>

<script>// ================= CONFIGURA√á√ÉO DO FIREBASE ================= //
const firebaseConfig = {
  apiKey: "AIzaSyCs-PeIHCTX1AUqlVEOGFKQRu4sPGba1ls",
  authDomain: "codepitch1.firebaseapp.com",
  projectId: "codepitch1",
  storageBucket: "codepitch1.appspot.com",
  messagingSenderId: "393929936980",
  appId: "1:393929936980:web:cd5b056d7add40732f1dc1"
};

// Inicializa o Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ================= VARI√ÅVEIS GLOBAIS ================= //
let projects = [];
let currentProjectId = null;

// ================= INICIALIZA√á√ÉO DA P√ÅGINA ================= //
document.addEventListener('DOMContentLoaded', () => {
  loadPostsFromFirestore();
  setupAuthListeners();
});

// ================= SISTEMA DE POSTS ================= //
async function loadPostsFromFirestore() {
  try {
    const grid = document.getElementById('projectsGrid');
    grid.innerHTML = '<p class="loading">Carregando projetos...</p>';
    
    const snapshot = await db.collection('projects')
      .orderBy('createdAt', 'desc')
      .get();

    if (snapshot.empty) {
      grid.innerHTML = '<p class="no-projects">Nenhum projeto encontrado.</p>';
      return;
    }
    
    projects = [];
    snapshot.forEach(doc => {
      const projectData = doc.data();
      projects.push({
        id: doc.id,
        ...projectData,
        // Garante que o nome do autor est√° presente
        author: projectData.author || "Autor desconhecido"
      });
    });
    
    refreshProjectsGrid();
    
  } catch (error) {
    console.error("Erro ao carregar posts:", error);
    projects = [...getFallbackProjects()];
    refreshProjectsGrid();
  }
}

function refreshProjectsGrid() {
  const grid = document.getElementById('projectsGrid');
  grid.innerHTML = '';

  const currentUser = auth.currentUser;

  projects.forEach(project => {
    const card = document.createElement('div');
    card.className = 'project-card';
    
    const createdAt = project.createdAt?.toDate ? project.createdAt.toDate() : new Date(project.createdAt);
    const isAuthor = currentUser && currentUser.uid === project.authorId;
    
    card.innerHTML = `
      <div class="project-header">
        <div class="project-avatar">${getInitials(project.author)}</div>
        <div>
          <h3>${project.title || "Projeto sem t√≠tulo"}</h3>
          <div class="project-author">Por ${project.author}</div>
          <div class="project-location">üìç ${project.location}</div>
        </div>
        ${isAuthor ? `
          <div class="project-actions-menu">
            <button class="menu-btn" onclick="toggleProjectMenu(this)">‚ãÆ</button>
            <div class="menu-options">
              <button onclick="deletePost('${project.id}')">Excluir</button>
              <button onclick="openEditModal('${project.id}')">Editar</button>
            </div>
          </div>
        ` : ''}
      </div>
      <div class="project-image">
        <img src="${project.image}" alt="${project.description}" onerror="this.src='https://via.placeholder.com/400x200?text=Imagem+n√£o+dispon√≠vel'">
      </div>
      <div class="project-description">${project.description}</div>
      <div class="project-actions">
        <button class="comment-btn" onclick="openComments('${project.id}', '${project.author}')">
          üí¨ Coment√°rios
        </button>
        <div class="project-tags">
          ${(project.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
        </div>
      </div>
      <div class="project-date">
        Postado em ${createdAt.toLocaleDateString('pt-BR')} √†s ${createdAt.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
      </div>
    `;
    grid.appendChild(card);
  });
}

function getInitials(name) {
  return name.split(' ').map(n => n[0]).join('').toUpperCase();
}

function getFallbackProjects() {
  return [
    {
      id: "1",
      title: "E-commerce Platform",
      author: "Maria Silva",
      location: "S√£o Paulo, SP",
      image: "https://imgs.search.brave.com/bAM5fcnemhP2h-qykELl60oruXYNqSRqlwQZpkg-lRc/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9zZWph/ZWZpLmNvbS5ici9w/b3J0YWwvd3AtY29u/dGVudC91cGxvYWRz/LzIwMjQvMTAvcGFn/YW1lbnRvLW9ubGlu/ZS5wbmc",
      description: "Plataforma de e‚Äëcommerce com carrinho, pagamento integrado e painel administrativo.",
      tags: ["React", "Node.js", "MongoDB"],
      createdAt: new Date('2023-01-15').toISOString()
    },
    {
      id: "2",
      title: "Sales Dashboard",
      author: "Jo√£o Santos",
      location: "Rio de Janeiro, RJ",
      image: "https://imgs.search.brave.com/ZYaopMwrlahUA2MEowLQU9wQz9YvvYIT8pzgRgjQcA4/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly9naXRo/dWIuY29tL3Bsb3Rs/eS9kYXNoLXNhbXBs/ZS1hcHBzL3Jhdy9t/YWluL2FwcHMvZGFz/aC1tYW51ZmFjdHVy/ZS1zcGMtZGFzaGJv/YXJkL2ltZy9zY3Jl/ZW5jYXB0dXJlMS5w/bmc",
      description: "Dashboard interativo para an√°lise de vendas em tempo real usando Python e Plotly.",
      tags: ["Python", "Pandas", "Plotly"],
      createdAt: new Date('2023-02-20').toISOString()
    },
    {
      id: "3",
      title: "Task Manager App",
      author: "Ana Costa",
      location: "Belo Horizonte, MG",
      image: "https://images.unsplash.com/photo-1558655146-d09347e92766?fit=crop&w=800&q=80",
      description: "App mobile de gerenciamento de tarefas com autentica√ß√£o e sincroniza√ß√£o via Firebase.",
      tags: ["React Native", "Firebase", "UX/UI"],
      createdAt: new Date('2023-03-10').toISOString()
    }
  ];
}

// ================= SISTEMA DE COMENT√ÅRIOS ================= //
async function openComments(projectId, author) {
  currentProjectId = projectId;
  const modal = document.getElementById('commentsModal');
  document.getElementById('modalTitle').textContent = `Coment√°rios - ${author}`;
  modal.style.display = 'block';
  await loadComments(projectId);
}

async function loadComments(projectId) {
  const commentsList = document.getElementById('commentsList');
  commentsList.innerHTML = '<p class="loading-comments">Carregando coment√°rios...</p>';

  try {
    const snapshot = await db.collection('comments')
      .where('projectId', '==', projectId)
      .orderBy('timestamp', 'desc')
      .get();

    if (snapshot.empty) {
      commentsList.innerHTML = '<p class="no-comments">Nenhum coment√°rio ainda. Seja o primeiro!</p>';
      return;
    }

    commentsList.innerHTML = '';
    const currentUser = auth.currentUser;

    snapshot.forEach(doc => {
      const comment = doc.data();
      const date = comment.timestamp?.toDate().toLocaleString('pt-BR') || 'Agora';
      
      commentsList.innerHTML += `
        <div class="comment">
          <div class="comment-header">
            <span class="comment-author">${comment.authorName}</span>
            ${currentUser?.uid === comment.authorId ? 
              `<button class="delete-comment-btn" onclick="deleteComment('${doc.id}')">üóëÔ∏è</button>` : ''}
          </div>
          <p class="comment-text">${comment.text}</p>
          <small class="comment-date">${date}</small>
        </div>
      `;
    });
  } catch (error) {
    console.error("Erro ao carregar coment√°rios:", error);
    commentsList.innerHTML = '<p class="error-comments">Erro ao carregar coment√°rios. Recarregue a p√°gina.</p>';
  }
}

async function addComment() {
  const user = auth.currentUser;
  if (!user) {
    alert('Voc√™ precisa estar logado para comentar!');
    return;
  }

  const text = document.getElementById('commentText').value.trim();
  if (!text) {
    alert('Digite um coment√°rio v√°lido!');
    return;
  }

  try {
    await db.collection('comments').add({
      projectId: currentProjectId,
      authorId: user.uid,
      authorName: user.displayName || user.email.split('@')[0],
      text: text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById('commentText').value = '';
    loadComments(currentProjectId);
  } catch (error) {
    console.error("Erro ao adicionar coment√°rio:", error);
    alert('Erro ao enviar coment√°rio. Tente novamente.');
  }
}

async function deleteComment(commentId) {
  if (!confirm('Tem certeza que deseja apagar este coment√°rio?')) return;
  
  try {
    await db.collection('comments').doc(commentId).delete();
    loadComments(currentProjectId);
  } catch (error) {
    console.error("Erro ao deletar coment√°rio:", error);
    alert('Erro ao apagar coment√°rio.');
  }
}

function closeModal() {
  document.getElementById('commentsModal').style.display = 'none';
}

// ================= AUTENTICA√á√ÉO ================= //
function setupAuthListeners() {
  auth.onAuthStateChanged(user => {
    updateUI(user);
    refreshProjectsGrid();
  });
}

function updateUI(user) {
  const loginBtn = document.getElementById('loginBtn');
  const userDropdown = document.getElementById('userDropdown');

  if (user) {
    loginBtn.style.display = 'none';
    userDropdown.style.display = 'block';
    document.getElementById('userNameDisplay').textContent = user.displayName || user.email.split('@')[0];
  } else {
    loginBtn.style.display = 'flex';
    userDropdown.style.display = 'none';
  }
}

function logout() {
  auth.signOut();
}

function toggleUserMenu() {
  const dropdown = document.getElementById('dropdownContent');
  dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
}

// ================= GERENCIAMENTO DE POSTS ================= //
async function deletePost(postId) {
  if (!confirm('Tem certeza que deseja excluir este projeto permanentemente?')) {
    return;
  }

  try {
    await db.collection('projects').doc(postId).delete();
    
    // Remove do array local
    projects = projects.filter(project => project.id !== postId);
    refreshProjectsGrid();
    
    alert('Projeto exclu√≠do com sucesso!');
  } catch (error) {
    console.error("Erro ao excluir projeto:", error);
    alert('Erro ao excluir projeto. Tente novamente.');
  }
}

function openEditModal(projectId) {
  const project = projects.find(p => p.id === projectId);
  if (!project) return;

  // Preenche o modal de edi√ß√£o
  document.getElementById('editPostTitle').value = project.title || '';
  document.getElementById('editPostLocation').value = project.location;
  document.getElementById('editPostImage').value = project.image;
  document.getElementById('editPostDescription').value = project.description;
  document.getElementById('editPostTags').value = project.tags.join(', ');
  document.getElementById('editProjectId').value = projectId;
  
  // Abre o modal de edi√ß√£o
  document.getElementById('editPostModal').style.display = 'block';
}

// ================= EVENTOS GLOBAIS ================= //
window.addEventListener('click', (e) => {
  if (!e.target.closest('.user-dropdown')) {
    document.getElementById('dropdownContent').style.display = 'none';
  }
  
  if (e.target === document.getElementById('commentsModal')) {
    closeModal();
  }
});

// ================= FUN√á√ïES GLOBAIS ================= //
window.openComments = openComments;
window.addComment = addComment;
window.deleteComment = deleteComment;
window.closeModal = closeModal;
window.logout = logout;
window.toggleUserMenu = toggleUserMenu;
window.deletePost = deletePost;
window.openEditModal = openEditModal;
window.toggleProjectMenu = toggleProjectMenu;</script>